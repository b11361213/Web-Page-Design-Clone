<!DOCTYPE html>
<html translate="no" lang=zh-Hans-TW>
    <head>
        <link rel="icon" type="image/gif" href="image/konata.gif">
        <link rel="stylesheet" type="text/css" href="i18n-items.css" />
        <link rel="stylesheet" type="text/css" href="i18n.css" />
        <link rel="stylesheet" type="text/css" href="main.css" />
        <meta charset="UTF-8">
        <meta name="google" content="notranslate">
        <script src="scripts\jquery.js"></script>
        <title>localhost/form.html</title>
        <style>
            [langSelect] span {
                background-color: gainsboro;
                border-radius: 3px;
                border: solid 1px;
                cursor: pointer;
                font-family: NotoSefif;
                padding: 3px;
            }
            [title] {
                margin-right: 26px;
            }
            [content] {
                flex-grow: 1;
                cursor: pointer;
                display: flex;
                padding-right: 50px;
            }
            [class="langSelect"] {
                font-family: NotoSefif;
                font-size: 16px;
            }
            [class="title"] {
                font-family: EduKai;
                font-size: 36px;
                font-weight: 700;
                margin-bottom: 28px;
                margin-top: 28px;
                text-align: center;
            }
            [class="date"] {
                font-family: NotoSefif;
                font-size: 18px;
                margin-bottom: 14px;
                text-align: left;
            }
            [class="content"] {
                font-family: EduKai;
                font-size: 24px;
                font-weight: 700;
                text-align: left;
                margin-bottom: 8px;
                margin-top: 10px;
            }
            [class="indentSubcontent"] {
                font-family: EduKai;
                font-size: 24px;
                font-weight: 400;
                margin-bottom: 12px;
                margin-top: 12px;
                text-align: left;
                text-indent: 160px;
            }
            [class="subContent"] {
                /* text-indent: 180px; */
                font-family: EduKai;
                font-size: 24px;
                font-weight: 400;
                margin-bottom: 12px;
                margin-top: 12px;
                text-align: left;
            }
            [class="subForm"] {
                /* background-color: azure; */
                border: solid 1px;
                font-family: EduKai;
                font-size: 22px;
                font-weight: 400;
                margin-bottom: 12px;
                margin-left: 180px;
                margin-right: 180px;
                margin-top: 12px;
                padding-bottom: 12px;
                padding-left: 32px;
                padding-top: 12px;
                text-align: left;
            }
            #memo {
                /* position:absolute; */
                /* right: 12px; */
                bottom: 4px;
                font-size: 14px;
            }
            #checkboxOption {
                margin-left: 24px;
            }
            flexrow {
                display: flex;
                flex-direction: row;
            }
            fill010 {
                flex-grow: 10;
            }
            fill001 {
                flex-grow: 1;
            }
            indentTitle {
                text-indent: 120px;
            }
            indentContent001 {
                text-indent: 160px;
            }
            indentContent002 {
                text-indent: 200px;
            }
        </style>
        <!-- [source](https://gazette.nat.gov.tw/EG_FileManager/eguploadpub/eg026150/ch04/type3/gov30/num13/images/Eg01.pdf) -->
        <!-- [source](https://www.etax.nat.gov.tw/etwmain/api/functions/etw212w/download/18a49929f0e00000c88d77d84d4a57bf/%E7%A9%BA%E7%99%BD%E6%9B%B8%E8%A1%A8(pdf%E4%B8%AD%E8%8B%B1%E4%B8%A6%E5%88%97).pdf) -->
        <!-- [災害損失減免使用牌照稅申請書](https://www.etax.nat.gov.tw/etwmain/etw212w/detail/18ad49bbcb20000031d7f1e06ad74269) -->
        <!-- [download source](https://www.etax.nat.gov.tw/etwmain/etw212w) -->
        <!-- [i18n Google sheets](https://docs.google.com/spreadsheets/d/1sp-Rw0xcjd-nEMIacbVywY5zIlCbBGr-Ja9EF0DgJfg) -->
    </head>
    <body language="Chinese">
        <span class="langSelect">Language select --</span>
        <span class="langSelect" langSelect>
            <span onclick="langChange(this);">Chinese</span>
            <span onclick="langChange(this);">English</span>
        </span>
        
        <!-- title -->
        <div class="title" i18n="header"></div>

        <!-- date -->
        <flexrow>
            <fill010></fill010>
            <div class="date" i18n="dateOfApplication">2023/09/22</div>
            <fill001></fill001>
        </flexrow>
        
        <!-- content -->
        <!-- recipient -->
        <indentTitle>
            <div class="content" i18n="recipient">
                <span class="content" i18n="ministryOfFinance"></span>
            </div>
        </indentTitle>
        
        <!-- purpose -->
        <indentTitle>
            <div class="content" i18n="purpose">
                <span class="content" i18n="toApplyFor"></span>
            </div>
            <div class="indentSubcontent" id="toApplyFor"></div>
        </indentTitle>

        <!-- description -->
        <indentTitle>
            <div class="content" i18n="description"></div>
        
            <indentContent001>
                <div class="subContent" i18n="descriptionA"></div>
                <div class="subContent" i18n="descriptionB"></div>
                <indentContent002>
                    <div class="subContent" i18n="descriptionBA"></div>
                    <div class="subContent" i18n="descriptionBB"></div>
                    <div class="subContent" i18n="descriptionBC"></div>
                    <div class="subContent" i18n="descriptionBD"></div>
                    <div class="subContent" i18n="descriptionBE"></div>
                    <div class="subContent" i18n="descriptionBF"></div>
                    <div class="subContent" i18n="descriptionBG"></div>
                    <div class="subContent" i18n="descriptionBH"></div>
                    <div class="subContent" i18n="descriptionBI"></div>
                </indentContent002>
            </indentContent001>

            
            <indentContent001>
                <div class="subContent" i18n="descriptionC"></div>
                <indentContent002>
                    <div class="subContent" i18n="descriptionCA"></div>
                    <div class="subContent" i18n="descriptionCB"></div>
                </indentContent002>
            </indentContent001>
        </indentTitle>
        
        <!-- information -->
        <indentTitle>
            <div class="content" i18n="applicantInformation"></div>
        </indentTitle>

        <!-- information form -->
        <div class="subForm">
            <flexrow information>
                <!-- <span i18n=name></span>
                <span content></span>
                <span i18n=identityCardNumber></span>
                <span content></span> -->
            </flexrow>
        </div>
        
        <!-- contact form -->
        <div class="subForm">
            <flexrow contact></flexrow>
        </div>
        
        <!-- residence -->
        <div class="subForm" i18n="residence">
            <flexrow style="flex-wrap: wrap;" residence></flexrow>
        </div>
        
        <!-- address form -->
        <div class="subForm">
            <flexrow address></flexrow>
        </div>

        <!-- footer memo -->
        <div id="memo">推薦使用 Firefox 瀏覽器瀏覽本網頁，以獲得最佳體驗</div>

        <script>
            function csvConvert(str) {return str.split(',').map(x=>x.trim()).filter(x=>x);}
            function langChange(obj) {
                // change language
                let lang = $(obj).text();
                $('body').attr('language', lang);
                
                // change font and size
                let elems = 'title, content, indentSubcontent, subContent, subForm';
                elems = csvConvert(elems);
                for (let elemsArray of elems) {
                    let elem = document.querySelectorAll(`[class=${elemsArray}]`);
                    for (let elemItem of elem) {
                        // elemItem.style = lang=='Chinese' ? 'font-family: EduKai;' : 'font-family: NotoSefif;';
                        elemItem.style.fontFamily = lang == 'Chinese' ? 'EduKai' : 'NotoSefif';
                        switch (elemsArray) {
                            case 'title':
                                elemItem.style.fontSize = lang == 'Chinese' ? '36px' : '30px';
                                break;
                            case 'content':
                                elemItem.style.fontSize = lang == 'Chinese' ? '24px' : '22px';
                                break;
                            case 'indentSubcontent':
                                elemItem.style.fontSize = lang == 'Chinese' ? '24px' : '22px';
                                break;
                            case 'subContent':
                                elemItem.style.fontSize = lang == 'Chinese' ? '24px' : '22px';
                                break;
                            case 'subForm':
                                elemItem.style.fontSize = lang == 'Chinese' ? '22px' : '20px';
                            //     break;
                            default:
                                break;
                        }
                    }
                }
                // [透過 JavaScript 動態修改CSS 樣式、屬性 - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天](https://ithelp.ithome.com.tw/articles/10226003)
                // [DOM CSS 修改 CSS 樣式 - JavaScript (JS) 教學 Tutorial](https://www.fooish.com/javascript/dom/css.html)
            }
            $.fn.OnClick = function(fun) {
                let o = this;
                $(o).css('cursor', 'pointer');
                $(o).on('click', fun);
                return this;
            }
            $.fn.dataFormUpdate = function(value) {
                let o = this;
                let col = $(o).closest('[dataForm]').attr('dataForm');
                console.log(col);
                let row = $(o).closest('[row]').prop('row');
                console.log(row);
                let {dataFormPrimaryKey} = row;
                $.post('query.php', {query: 'modify', dataFormPrimaryKey, col, value}, function(msg) {
                    console.log(msg);
                })
            }

            // 申請...
            $.fn.applyForSelect = function(row) {
                let o = this;
                $(o).attr('row', '').prop('row', row);
                let {dataFormFirstTime, dataFormCertificateHasCeased, dataFormLost, dataFormReplacement, dataFormEnglishVersion} = row;
                // let select, value;
                $('[dataForm="dataFormFirstTime"]',               o).attr('select', dataFormFirstTime             == '1' ? 'true' : 'false');
                $('[dataForm="dataFormCertificateHasCeased"]',    o).attr('select', dataFormCertificateHasCeased  == '1' ? 'true' : 'false');
                $('[dataForm="dataFormLost"]',                    o).attr('select', dataFormLost                  == '1' ? 'true' : 'false');
                $('[dataForm="dataFormReplacement"]',             o).attr('select', dataFormReplacement           == '1' ? 'true' : 'false');
                $('[dataForm="dataFormEnglishVersion"]',          o).attr('select', dataFormEnglishVersion        == '1' ? 'true' : 'false');
            }
            function applyForSel(obj) {
                let i18ns = csvConvert(`firstTime, certificateHasCeased, lost, replacement, englishVersion`);
                let dataForms = csvConvert(`dataFormFirstTime, dataFormCertificateHasCeased, dataFormLost, dataFormReplacement, dataFormEnglishVersion`);
                // let items = ['firstTime', 'certificateHasCeased', 'lost', 'replacement', 'englishVersion'];

                for (let index = 0; index < i18ns.length; index++) {
                    $(`<div class="indentSubcontent" select="false" i18n="${i18ns[index]}" dataForm="${dataForms[index]}"></div>`).appendTo(obj).OnClick(function(e) {
                        let u = e.currentTarget;
                        let select = $(u).attr('select');
                        if (select == 'false') {
                            select = 'true';
                            $(u).siblings().attr('select', 'false');
                        }
                        else {
                            select = 'false';
                        }
                        $(u).attr('select', select);
                        $(u).dataFormUpdate(select == 'true' ? '1' : '0');
                    });
                }
            }

            // 申請人資料...
            $.fn.fillInSelect = function(row) {
                let o = this;
                $(o).attr('row', '').prop('row', row);
                let {dataFormApplicant, dataFormIdentityCardNumber, dataFormContactNumber, dataFormPhoneNumber, dataFormAddress} = row;
                // let value = dataFormApplicant;
                // $('[dataForm=dataFormApplicant]').html(value);
                $('[dataForm="dataFormApplicant"]'            ).html(dataFormApplicant);
                $('[dataForm="dataFormIdentityCardNumber"]'   ).html(dataFormIdentityCardNumber);
                $('[dataForm="dataFormContactNumber"]'        ).html(dataFormContactNumber);
                $('[dataForm="dataFormPhoneNumber"]'          ).html(dataFormPhoneNumber);
                $('[dataForm="dataFormAddress"]'              ).html(dataFormAddress);
            }
            function fillOut(obj, tag) {
                $.fn.fillIn = function(i18n, dataForm) {
                    let obj = this;
                    let value = 5050;
                    $(`
                    <span i18n="${i18n}" title></span>
                    `).appendTo(obj);
                    $(`
                    <span dataForm="${dataForm}" content>${value}</span>
                    `).appendTo(obj).OnClick((e)=>{
                        let u = $(e.currentTarget);
                        let old = u.html(); u.html('');
                        let tbox = $('<textarea rows=1 cols=12>').html(old).appendTo(u).OnClick((e)=>{
                                let o = $(e.currentTarget);
                                e.stopPropagation();
                            }).on('blur', e=>{
                                let tbox = e.currentTarget;
                                $(u).html($(tbox).val());
                                $(u).dataFormUpdate($(tbox).val());
                            });

                            tbox.get(0).setSelectionRange(old.length, old.length);
                            tbox.trigger('focus');
                        });
                        return this;
                    }

                if (tag == 'info') {
                obj.fillIn('applicant', 'dataFormApplicant').append('<fillOne>').fillIn('identityCardNumber', 'dataFormIdentityCardNumber').append('<fillOne>');
                }
                if (tag == 'contact') {
                    obj.fillIn('contactNumber', 'dataFormContactNumber').append('<fillOne>').fillIn('phoneNumber', 'dataFormPhoneNumber').append('<fillOne>');
                }
                if (tag == 'address') {
                    obj.fillIn('address', 'dataFormAddress').append('<fillOne>');
                }
            }
            $.fn.residenceSelect = function(row) {
                let o = this;
                $(o).attr('row', '').prop('row', row);
                let {dataFormResidence} = row;

                // let dataForms = csvConvert(`
                //     dataFormTaipeiCity, dataFormKeelungCity, dataFormNewTaipeiCity, dataFormLienchiangCounty, 
                //     dataFormYilanCounty, dataFormHsinchuCity, dataFormHsinchuCounty, dataFormTaoyuanCity, 
                //     dataFormMiaoliCounty, dataFormTaichungCity, dataFormChanghuaCounty, dataFormNantouCounty, 
                //     dataFormChiayiCity, dataFormChiayiCounty, dataFormYunlinCounty, dataFormTainanCity, 
                //     dataFormKaohsiungCity, dataFormPenghuCounty, dataFormKinmenCounty, dataFormPingtungCounty, 
                //     dataFormTaitungCounty, dataFormHualienCounty
                //     `);
                // let values = csvConvert(`
                //     台北市, 基隆市, 新北市, 連江縣, 
                //     宜蘭縣, 新竹市, 新竹縣, 桃園市, 
                //     苗栗縣, 台中市, 彰化縣, 南投縣, 
                //     嘉義市, 嘉義縣, 雲林縣, 台南市, 
                //     高雄市, 澎湖縣, 金門縣, 屏東縣, 
                //     台東縣, 花蓮縣
                //     `);

                // for (let index = 0; index < dataForms.length; index++) {
                //     $(`'[dataForm=${dataForms[index]}]'`, `${o}`).attr('select', `${dataFormResidence}` == `'${values[index]}'` ? 'true' : 'false')
                // }

                $('[valueIndex="dataFormTaipeiCity"]',          o).attr('select', dataFormResidence == '台北市' ? 'true' : 'false');
                $('[valueIndex="dataFormKeelungCity"]',         o).attr('select', dataFormResidence == '基隆市' ? 'true' : 'false');
                $('[valueIndex="dataFormNewTaipeiCity"]',       o).attr('select', dataFormResidence == '新北市' ? 'true' : 'false');
                $('[valueIndex="dataFormLienchiangCounty"]',    o).attr('select', dataFormResidence == '連江縣' ? 'true' : 'false');

                $('[valueIndex="dataFormYilanCounty"]',         o).attr('select', dataFormResidence == '宜蘭縣' ? 'true' : 'false');
                $('[valueIndex="dataFormHsinchuCity"]',         o).attr('select', dataFormResidence == '新竹市' ? 'true' : 'false');
                $('[valueIndex="dataFormHsinchuCounty"]',       o).attr('select', dataFormResidence == '新竹縣' ? 'true' : 'false');
                $('[valueIndex="dataFormTaoyuanCity"]',         o).attr('select', dataFormResidence == '桃園市' ? 'true' : 'false');

                $('[valueIndex="dataFormMiaoliCounty"]',        o).attr('select', dataFormResidence == '苗栗縣' ? 'true' : 'false');
                $('[valueIndex="dataFormTaichungCity"]',        o).attr('select', dataFormResidence == '台中市' ? 'true' : 'false');
                $('[valueIndex="dataFormChanghuaCounty"]',      o).attr('select', dataFormResidence == '彰化縣' ? 'true' : 'false');
                $('[valueIndex="dataFormNantouCounty"]',        o).attr('select', dataFormResidence == '南投縣' ? 'true' : 'false');
                
                $('[valueIndex="dataFormChiayiCity"]',          o).attr('select', dataFormResidence == '嘉義市' ? 'true' : 'false');
                $('[valueIndex="dataFormChiayiCounty"]',        o).attr('select', dataFormResidence == '嘉義縣' ? 'true' : 'false');
                $('[valueIndex="dataFormYunlinCounty"]',        o).attr('select', dataFormResidence == '雲林縣' ? 'true' : 'false');
                $('[valueIndex="dataFormTainanCity"]',          o).attr('select', dataFormResidence == '台南市' ? 'true' : 'false');
                
                $('[valueIndex="dataFormKaohsiungCity"]',       o).attr('select', dataFormResidence == '高雄市' ? 'true' : 'false');
                $('[valueIndex="dataFormPenghuCounty"]',        o).attr('select', dataFormResidence == '澎湖縣' ? 'true' : 'false');
                $('[valueIndex="dataFormKinmenCounty"]',        o).attr('select', dataFormResidence == '金門縣' ? 'true' : 'false');
                $('[valueIndex="dataFormPingtungCounty"]',      o).attr('select', dataFormResidence == '屏東縣' ? 'true' : 'false');
                
                $('[valueIndex="dataFormTaitungCounty"]',       o).attr('select', dataFormResidence == '台東縣' ? 'true' : 'false');
                $('[valueIndex="dataFormHualienCounty"]',       o).attr('select', dataFormResidence == '花蓮縣' ? 'true' : 'false');
            }
            function residenceSel(obj) {
                let i18ns = csvConvert(`
                    taipeiCity, keelungCity, newTaipeiCity, lienchiangCounty, 
                    yilanCounty, hsinchuCity, hsinchuCounty, taoyuanCity, 
                    miaoliCounty, taichungCity, changhuaCounty, nantouCounty, 
                    chiayiCity, chiayiCounty, yunlinCounty, tainanCity, 
                    kaohsiungCity, penghuCounty, kinmenCounty, pingtungCounty, 
                    taitungCounty, hualienCounty
                    `);

                let valueIndex = csvConvert(`
                    dataFormTaipeiCity, dataFormKeelungCity, dataFormNewTaipeiCity, dataFormLienchiangCounty, 
                    dataFormYilanCounty, dataFormHsinchuCity, dataFormHsinchuCounty, dataFormTaoyuanCity, 
                    dataFormMiaoliCounty, dataFormTaichungCity, dataFormChanghuaCounty, dataFormNantouCounty, 
                    dataFormChiayiCity, dataFormChiayiCounty, dataFormYunlinCounty, dataFormTainanCity, 
                    dataFormKaohsiungCity, dataFormPenghuCounty, dataFormKinmenCounty, dataFormPingtungCounty, 
                    dataFormTaitungCounty, dataFormHualienCounty
                    `);
                let values = csvConvert(`
                    台北市, 基隆市, 新北市, 連江縣, 
                    宜蘭縣, 新竹市, 新竹縣, 桃園市, 
                    苗栗縣, 台中市, 彰化縣, 南投縣, 
                    嘉義市, 嘉義縣, 雲林縣, 台南市, 
                    高雄市, 澎湖縣, 金門縣, 屏東縣, 
                    台東縣, 花蓮縣
                    `);

                for (let index = 0; index < i18ns.length; index++) {
                    $(`<span style=white-space: nowrap select="false" i18n="${i18ns[index]}" dataForm="dataFormResidence" valueIndex="${valueIndex[index]}" id="checkboxOption"></div>`).appendTo(obj).OnClick(function(e) {
                        let u = e.currentTarget;
                        let select = $(u).attr('select');
                        if (select == 'false') {
                            select = 'true';
                            $(u).siblings().attr('select', 'false');
                        }
                        else {
                            select = 'false';
                        }
                        $(u).attr('select', select);
                        $(u).dataFormUpdate(values[index]);
                    });
                };
            }

            applyForSel($('[id="toApplyFor"]'));
            residenceSel($('[residence]'));

            fillOut($('[information]'), 'info');
            fillOut($('[contact]'), 'contact');
            fillOut($('[address]'), 'address');

            $(document).ready(function() {
                $.post('query.php', {query: 'retrieve'}, function(element) {
                    let {rows} = element, row = rows[0];
                    $('[id="toApplyFor"]').applyForSelect(row);
                }, 'json');

                $.post('query.php', {query: 'retrieve'}, function(element) {
                    let {rows} = element, row = rows[0];
                    $('[class="subForm"]').fillInSelect(row);
                    $('[class="subForm"]').residenceSelect(row);
                }, 'json');
            });
        </script>
    </body>
</html>
