<!DOCTYPE html>
<html translate="no" lang=zh-Hans-TW>
    <head>
        <link rel="icon" type="image/gif" href="image/konata.gif">
        <link rel="stylesheet" type="text/css" href="i18n-items.css" />
        <link rel="stylesheet" type="text/css" href="i18n.css" />
        <link rel="stylesheet" type="text/css" href="main.css" />
        <meta charset="UTF-8">
        <meta name="google" content="notranslate">
        <script src="scripts\jquery.js"></script>
        <title>localhost/form.html</title>
        <style>
            [langSelect] span {
                background-color: gainsboro;
                border-radius: 3px;
                border: solid 1px;
                cursor: pointer;
                font-family: NotoSefif;
                padding: 3px;
            }
            [title] {
                margin-right: 26px;
            }
            [content] {
                /* flex-grow: 1; */
                cursor: pointer;
                display: flex;
                padding-right: 50px;
            }
            [class=langSelect] {
                font-family: NotoSefif;
                font-size: 16px;
            }
            [class=title] {
                font-family: EduKai;
                font-size: 36px;
                font-weight: 700;
                margin-bottom: 28px;
                margin-top: 28px;
                text-align: center;
}
            [class=date] {
                font-family: NotoSefif;
                font-size: 18px;
                margin-bottom: 14px;
                text-align: left;
            }
            [class=content] {
                font-family: EduKai;
                font-size: 24px;
                font-weight: 700;
                text-align: left;
                margin-bottom: 8px;
                margin-top: 10px;
            }
            [class=indentSubcontent] {
                font-family: EduKai;
                font-size: 24px;
                font-weight: 400;
                margin-bottom: 12px;
                margin-top: 12px;
                text-align: left;
                text-indent: 160px;
            }
            [class=subContent] {
                /* text-indent: 180px; */
                font-family: EduKai;
                font-size: 24px;
                font-weight: 400;
                margin-bottom: 12px;
                margin-top: 12px;
                text-align: left;
            }
            [class=subForm] {
                /* background-color: azure; */
                border: solid 1px;
                font-family: EduKai;
                font-size: 22px;
                font-weight: 400;
                margin-bottom: 12px;
                margin-left: 180px;
                margin-right: 180px;
                margin-top: 12px;
                padding-bottom: 12px;
                padding-left: 32px;
                padding-top: 12px;
                text-align: left;
            }
            #memo {
                /* position:absolute; */
                /* right: 12px; */
                bottom: 4px;
                font-size: 14px;
            }
            #checkboxOption {
                margin-left: 24px;
            }
            flexrow {
                display: flex;
                flex-direction: row;
            }
            fill010 {
                flex-grow: 10;
            }
            fill001 {
                flex-grow: 1;
            }
            indentTitle {
                text-indent: 120px;
            }
            indentContent001 {
                text-indent: 160px;
            }
            indentContent002 {
                text-indent: 200px;
            }
        </style>
        <!-- [source](https://gazette.nat.gov.tw/EG_FileManager/eguploadpub/eg026150/ch04/type3/gov30/num13/images/Eg01.pdf) -->
        <!-- [source](https://www.etax.nat.gov.tw/etwmain/api/functions/etw212w/download/18a49929f0e00000c88d77d84d4a57bf/%E7%A9%BA%E7%99%BD%E6%9B%B8%E8%A1%A8(pdf%E4%B8%AD%E8%8B%B1%E4%B8%A6%E5%88%97).pdf) -->
        <!-- [災害損失減免使用牌照稅申請書](https://www.etax.nat.gov.tw/etwmain/etw212w/detail/18ad49bbcb20000031d7f1e06ad74269) -->
        <!-- [download source](https://www.etax.nat.gov.tw/etwmain/etw212w) -->
        <!-- [i18n Google sheets](https://docs.google.com/spreadsheets/d/1sp-Rw0xcjd-nEMIacbVywY5zIlCbBGr-Ja9EF0DgJfg) -->
    </head>
    <body language="Chinese">
        <span class=langSelect>Language select --</span>
        <span class=langSelect langSelect>
            <span onclick="langChange(this);">Chinese</span>
            <span onclick="langChange(this);">English</span>
        </span>
        
        <!-- title -->
        <div class=title i18n=header></div>

        <!-- date -->
        <flexrow>
            <fill010></fill010>
            <div class=date i18n=dateOfApplication>2023/09/22</div>
            <fill001></fill001>
        </flexrow>
        
        <!-- content -->
        <!-- recipient -->
        <indentTitle>
            <div class=content i18n=recipient>
                <span class=content i18n=ministryOfFinance></span>
            </div>
        </indentTitle>
        
        <!-- purpose -->
        <indentTitle>
            <div class=content i18n=purpose>
                <span class=content i18n=toApplyFor></span>
            </div>
            <div class=indentSubcontent id=purpose></div>
        </indentTitle>

        <!-- description -->
        <indentTitle>
            <div class=content i18n=description></div>
        
            <indentContent001>
                <div class=subContent i18n=descriptionA></div>
                <div class=subContent i18n=descriptionB></div>
                <indentContent002>
                    <div class=subContent i18n=descriptionBA></div>
                    <div class=subContent i18n=descriptionBB></div>
                    <div class=subContent i18n=descriptionBC></div>
                    <div class=subContent i18n=descriptionBD></div>
                    <div class=subContent i18n=descriptionBE></div>
                    <div class=subContent i18n=descriptionBF></div>
                    <div class=subContent i18n=descriptionBG></div>
                    <div class=subContent i18n=descriptionBH></div>
                    <div class=subContent i18n=descriptionBI></div>
                </indentContent002>
            </indentContent001>

            
            <indentContent001>
                <div class=subContent i18n=descriptionC></div>
                <indentContent002>
                    <div class=subContent i18n=descriptionCA></div>
                    <div class=subContent i18n=descriptionCB></div>
                </indentContent002>
            </indentContent001>
        </indentTitle>
        
        <!-- information -->
        <indentTitle>
            <div class=content i18n=applicantInformation></div>
        </indentTitle>

        <!-- information form -->
        <div class=subForm>
            <flexrow information>
                <!-- <span i18n=name></span>
                <span content></span>
                <span i18n=identityCardNumber></span>
                <span content></span> -->
            </flexrow>
        </div>
        
        <!-- contact form -->
        <div class=subForm>
            <flexrow contact></flexrow>
        </div>
        
        <!-- residence -->
        <div class=subForm i18n=residence>
            <flexrow style="flex-wrap: wrap;" residence></flexrow>
        </div>
        
        <!-- address form -->
        <div class=subForm>
            <flexrow address></flexrow>
        </div>

        <!-- footer memo -->
        <div id=memo>推薦使用 Firefox 瀏覽器瀏覽本網頁，以獲得最佳體驗</div>

        <script>
            function csvConvert(str) {return str.split(",").map(x=>x.trim()).filter(x=>x);}
            function langChange(obj) {
                // change language
                let lang = $(obj).text();
                $("body").attr("language", lang);
                
                // change font and size
                let elems = "title, content, indentSubcontent, subContent, subForm";
                elems = csvConvert(elems);
                for (let elemsArray of elems) {
                    let elem = document.querySelectorAll(`[class=${elemsArray}]`);
                    for (let elemItem of elem) {
                        // elemItem.style = lang=="Chinese" ? "font-family: EduKai;" : "font-family: NotoSefif;";
                        elemItem.style.fontFamily = lang == "Chinese" ? "EduKai" : "NotoSefif";
                        switch (elemsArray) {
                            case "title":
                                elemItem.style.fontSize = lang == "Chinese" ? "36px" : "30px";
                                break;
                            case "content":
                                elemItem.style.fontSize = lang == "Chinese" ? "24px" : "22px";
                                break;
                            case "indentSubcontent":
                                elemItem.style.fontSize = lang == "Chinese" ? "24px" : "22px";
                                break;
                            case "subContent":
                                elemItem.style.fontSize = lang == "Chinese" ? "24px" : "22px";
                                break;
                            case "subForm":
                                elemItem.style.fontSize = lang == "Chinese" ? "22px" : "20px";
                            //     break;
                            default:
                                break;
                        }
                    }
                }
                // [透過 JavaScript 動態修改CSS 樣式、屬性 - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天](https://ithelp.ithome.com.tw/articles/10226003)
                // [DOM CSS 修改 CSS 樣式 - JavaScript (JS) 教學 Tutorial](https://www.fooish.com/javascript/dom/css.html)
            }
            $.fn.OnClick = function(fun) {
                let o = this;
                $(o).css('cursor', 'pointer');
                $(o).on('click', fun);
                return this;
            }
            $.fn.applyForSelect = function(row) {
                let o = this;
                $(o).attr("row", "").prop("row", row);
                let {dataFormFirstTime, dataFormCertificateHasCeased, dataFormLost, dataFormReplacement, dataFormEnglishVersion} = row;
                let select, value;
                $("[dataForm=dataFormFirstTime]", o).attr("select", dataFormFirstTime == "1" ? "true" : "false");
                $("[dataForm=dataFormCertificateHasCeased]", o).attr("select", dataFormCertificateHasCeased == "1" ? "true" : "false");
                $("[dataForm=dataFormLost]", o).attr("select", dataFormLost == "1" ? "true" : "false");
                $("[dataForm=dataFormReplacement]", o).attr("select", dataFormReplacement == "1" ? "true" : "false");
                $("[dataForm=dataFormEnglishVersion]", o).attr("select", dataFormEnglishVersion == "1" ? "true" : "false");
            }
            $.fn.applyForUpdate = function(value) {
                let o = this;
                let col = $(o).closest("[col]").attr("col");
                let row = $(o).closest("[rows]").prop("rows");
                let {primaryKey} = row;
                $.post("query.php", {query: "modify", primaryKey, col, value}, function(msg) {
                    console.log(msg);
                })
            }
            function applyForSel(obj) {
                let i18ns = csvConvert(`firstTime, certificateHasCeased, lost, replacement, englishVersion`);
                let dataForms = csvConvert(`dataFormFirstTime, dataFormCertificateHasCeased, dataFormLost, dataFormReplacement, dataFormEnglishVersion`);
                // let items = ["firstTime", "certificateHasCeased", "lost", "replacement", "englishVersion"];

                for (let index = 0; index < i18ns.length; index++) {
                    $(`<div class=indentSubcontent select=false i18n=${i18ns[index]} dataForm=${dataForms[index]}></div>`).appendTo(obj).OnClick(function(e) {
                        let u = e.currentTarget;
                        let select = $(u).attr('select');
                        if (select == 'false') {
                            select = 'true';
                            $(u).siblings().attr('select', 'false');
                        }
                        else {
                            select = 'false';
                        }
                        $(u).attr('select', select);
                        $(u).applyForUpdate(select == "true" ? "1" : "0");
                    });
                }
            }
            function residenceSel(obj) {
                let i18ns = csvConvert(`
                    taipeiCity, keelungCity, newTaipeiCity, lienchiangCounty, 
                    yilanCounty, hsinchuCity, hsinchuCounty, taoyuanCity, 
                    miaoliCounty, taichungCity, changhuaCounty, nantouCounty, 
                    chiayiCity, chiayiCounty, yunlinCounty, tainanCity, 
                    kaohsiungCity, penghuCounty, kinmenCounty, pingtungCounty, 
                    taitungCounty, hualienCounty
                    `);

                let dataForms = csvConvert(`
                    dataFormTaipeiCity, dataFormKeelungCity, dataFormNewTaipeiCity, dataFormLienchiangCounty, 
                    dataFormYilanCounty, dataFormHsinchuCity, dataFormHsinchuCounty, dataFormTaoyuanCity, 
                    dataFormMiaoliCounty, dataFormTaichungCity, dataFormChanghuaCounty, dataFormNantouCounty, 
                    dataFormChiayiCity, dataFormChiayiCounty, dataFormYunlinCounty, dataFormTainanCity, 
                    dataFormKaohsiungCity, dataFormPenghuCounty, dataFormKinmenCounty, dataFormPingtungCounty, 
                    dataFormTaitungCounty, dataFormHualienCounty
                    `);

                for (let index = 0; index < i18ns.length; index++) {
                    $(`<span style=white-space: nowrap select=false i18n=${i18ns[index]} dataForm=${dataForms[index]} id=checkboxOption></div>`).appendTo(obj).OnClick(function(e) {
                        let u = e.currentTarget;
                        let select = $(u).attr('select');
                        if (select == 'false') {
                            select = 'true';
                            $(u).siblings().attr('select', 'false');
                        }
                        else {
                            select = 'false';
                        }
                        $(u).attr('select', select);
                    });
                };
            }
            function fillOut(obj, tag) {
                $.fn.fillIn = function(title) {
                    let obj = this;
                    let value = 5050;
                    $(`
                    <span i18n=${title} title></span>
                    `).appendTo(obj);
                    $(`
                    <span content>${value}</span>
                    `).appendTo(obj).OnClick((e)=>{
                        let u = $(e.currentTarget);
                        let old = u.html(); u.html("");
                        let tbox = $("<textarea rows=1 cols=12>").html(old).appendTo(u).OnClick((e)=>{
                                let o = $(e.currentTarget);
                                e.stopPropagation();
                            }).on("blur", e=>{
                                let tbox = e.currentTarget;
                                $(u).html($(tbox).val());
                            });

                            tbox.get(0).setSelectionRange(old.length, old.length);
                            tbox.trigger('focus');
                        });
                        return this;
                    }
                    
                    if (tag == "info") {
                    obj.fillIn("applicant").append("<fillOne>").fillIn("identityCardNumber").append("<fillOne>");
                    }
                    if (tag == "contact") {
                        obj.fillIn("contactNumber").append("<fillOne>").fillIn("phoneNumber").append("<fillOne>");
                    }
                    if (tag == "address") {
                        obj.fillIn("address").append("<fillOne>");
                    }
                }

            applyForSel($("[id=purpose]"));
            residenceSel($("[residence]"));

            fillOut($("[information]"), "info");
            fillOut($("[contact]"), "contact");
            fillOut($("[address]"), "address");

            $(document).ready(function() {
                $.post("query.php", {query: "retrieve"}, function(element) {
                    let {rows} = element, row = rows[0];
                    $("[id=purpose]").applyForSelect(row);
                }, "json")
            });
        </script>
    </body>
</html>
